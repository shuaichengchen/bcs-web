<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>肉牛体况智能评价系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

    <!-- iOS PWA 支持 -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="牛体BCS">
    <meta name="theme-color" content="#2b7cff">

    <style>
        :root{
            --blue:#2b7cff;
            --green:#20c997;
            --ink:#2b3a4a;
            --muted:#6b7b8c;
            --bg1:#f3f7ff;
            --bg2:#ecfff7;
            --card:#ffffff;
            --line:#cfe0ff;

            --warn-bg:#fff7e6;
            --warn-text:#8a5a00;

            --err-bg:#ffefef;
            --err-text:#db2c22;
            --err-line:#ffd0d0;
        }

        *{ box-sizing: border-box; }

        body{
            background: linear-gradient(135deg, var(--bg1), var(--bg2));
            min-height: 100vh;
            margin: 0;
            font-family: 'HarmonyOS Sans','Microsoft YaHei', Arial, sans-serif;
            color: var(--ink);
        }

        .wrap{
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 28px 14px 40px;
        }

        .card{
            width: 420px;
            background: var(--card);
            border-radius: 26px;
            box-shadow: 0 10px 34px rgba(72,125,255,0.10);
            padding: 34px 28px 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo{
            width: 90px;
            height: 90px;
            border-radius: 50%;
            object-fit: cover;
            border: 2.5px solid #bfead6;
            background: #f7fbff;
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
        }

        .title{
            font-size: 1.55rem;
            font-weight: 800;
            color: var(--blue);
            letter-spacing: 2px;
            text-align: center;
            margin: 12px 0 6px;
        }

        .subtitle{
            font-size: 0.92rem;
            color: var(--muted);
            margin: 0 0 22px;
            text-align: center;
        }

        .form{
            width: 100%;
        }

        .input-row{
            display: flex;
            align-items: center;
            margin-bottom: 14px;
            width: 100%;
        }

        .input-row label{
            min-width: 86px;
            margin-right: 10px;
            text-align: right;
            font-size: 1rem;
            color: #2f4f6b;
            font-weight: 600;
            letter-spacing: 1px;
        }

        .hint-dot{
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #eaf2ff;
            color: #3c6fff;
            font-size: 12px;
            line-height: 16px;
            text-align: center;
            margin-left: 6px;
            cursor: help;
            border: 1px solid #d7e4ff;
        }

        .input-wrap{
            position: relative;
            flex: 1;
        }

        .input-wrap input{
            width: 100%;
            padding: 9px 42px 9px 12px;
            border: 1.2px solid var(--line);
            border-radius: 9px;
            background: #f7fbff;
            font-size: 1rem;
            transition: border 0.22s, box-shadow 0.22s, background 0.22s;
        }

        .input-wrap input:focus{
            border: 1.4px solid var(--blue);
            outline: none;
            background: #f2fbff;
            box-shadow: 0 0 0 3px rgba(43,124,255,0.10);
        }

        .unit{
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #aab8c6;
            font-size: 0.98em;
            pointer-events: none;
        }

        .btn-row{
            display: flex;
            gap: 10px;
            width: 100%;
            margin-top: 8px;
        }

        .btn{
            flex: 1;
            background: linear-gradient(90deg, var(--blue) 15%, var(--green) 90%);
            color: #fff;
            font-size: 1.02rem;
            padding: 10px 0;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 1px;
            box-shadow: 0 3px 10px rgba(50,120,255,0.20);
            transition: transform 0.08s ease, filter 0.2s;
        }

        .btn:hover{ filter: brightness(0.98); }
        .btn:active{ transform: translateY(1px); }

        .btn-secondary{
            flex: 1;
            background: #f2f6ff;
            color: #2f4f6b;
            border: 1px solid #d9e6ff;
            box-shadow: none;
            font-weight: 600;
        }

        .link-row{
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .link-row a{
            font-size: 0.92rem;
            color: #2b7cff;
            text-decoration: none;
        }

        .result-block{
            background: linear-gradient(135deg, #eef6ff, #eafff6);
            border: 1px solid #dff0ff;
            border-radius: 12px;
            margin: 16px 0 4px;
            padding: 18px 20px 12px;
            text-align: left;
            width: 100%;
            font-size: 1.05rem;
        }

        .score-badge{
            display: inline-block;
            padding: 2px 10px;
            border-radius: 999px;
            background: #ffffff;
            border: 1px solid #d9ebff;
            color: #135bd6;
            font-weight: 800;
            font-size: 1.15em;
            margin-left: 6px;
        }

        .result-label{
            color: #0ea77b;
            font-weight: 700;
        }

        .confidence{
            margin-top: 6px;
            color: #2c6a5f;
            font-size: 0.96em;
        }

        .inputs-list{
            color: #35526c;
            font-size: 0.95em;
            margin-top: 9px;
            line-height: 1.5;
        }

        .inputs-list span{
            margin-right: 10px;
            display: inline-block;
        }

        .warn-msg{
            margin: 12px 0 0;
            color: var(--warn-text);
            background: var(--warn-bg);
            border: 1px dashed #ffd28a;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 0.95rem;
            width: 100%;
        }

        .error-msg{
            margin: 14px 0 0;
            color: var(--err-text);
            background: var(--err-bg);
            border-radius: 8px;
            padding: 11px 14px;
            font-size: 1rem;
            text-align: center;
            font-weight: 600;
            width: 100%;
            border: 1px solid var(--err-line);
        }

        .footer{
            margin-top: 22px;
            color: #9aa6b2;
            font-size: 0.98em;
            letter-spacing: 1px;
            text-align: center;
        }

        .footer small{
            display: block;
            margin-top: 6px;
            font-size: 0.88em;
            color: #b1bcc7;
        }

        @media (max-width: 520px){
            .card{
                width: 94vw;
                padding: 22px 5vw 14px;
            }
        }
    </style>
</head>
<body>
<div class="wrap">
    <div class="card">
        <img class="logo" src="{{ url_for('static', filename='logo.png') }}" alt="logo">

        <div class="title">肉牛体况智能评价系统</div>
        <div class="subtitle">基于关键体尺指标的BCS智能预测原型</div>

        <form class="form" method="POST" id="bcsForm" autocomplete="off">
            <div class="input-row">
                <label>
                    体斜长
                    <span class="hint-dot" title="肩端至坐骨端斜向长度">?</span>：
                </label>
                <div class="input-wrap">
                    <input type="number" step="0.1" name="体斜长" value="{{ inputs.get('体斜长','') }}">
                    <span class="unit">cm</span>
                </div>
            </div>

            <div class="input-row">
                <label>
                    胸围
                    <span class="hint-dot" title="肩胛后缘胸部最大围度">?</span>：
                </label>
                <div class="input-wrap">
                    <input type="number" step="0.1" name="胸围" value="{{ inputs.get('胸围','') }}">
                    <span class="unit">cm</span>
                </div>
            </div>

            <div class="input-row">
                <label>
                    腹围
                    <span class="hint-dot" title="腹部最大围度">?</span>：
                </label>
                <div class="input-wrap">
                    <input type="number" step="0.1" name="腹围" value="{{ inputs.get('腹围','') }}">
                    <span class="unit">cm</span>
                </div>
            </div>

            <div class="input-row">
                <label>
                    腰角宽
                    <span class="hint-dot" title="髋部/腰角区域最大宽度">?</span>：
                </label>
                <div class="input-wrap">
                    <input type="number" step="0.1" name="腰角宽" value="{{ inputs.get('腰角宽','') }}">
                    <span class="unit">cm</span>
                </div>
            </div>

            <div class="input-row">
                <label>
                    体高
                    <span class="hint-dot" title="鬐甲最高点至地面垂直高度">?</span>：
                </label>
                <div class="input-wrap">
                    <input type="number" step="0.1" name="体高" value="{{ inputs.get('体高','') }}">
                    <span class="unit">cm</span>
                </div>
            </div>

            <!-- 主要操作 -->
            <div class="btn-row">
                <button type="submit" class="btn">一键预测</button>
                <!-- 直接复用当前表单数据导出PDF -->
                <button type="submit"
                        class="btn btn-secondary"
                        formaction="{{ url_for('single_report') }}">
                    导出PDF简报
                </button>
            </div>

            <!-- 辅助操作 -->
            <div class="btn-row" style="margin-top:8px;">
                <button type="button" class="btn btn-secondary" id="fillDemo">示例数据</button>
                <button type="button" class="btn btn-secondary" id="clearAll">清空</button>
            </div>
        </form>

        <div class="link-row">
            <a href="{{ url_for('batch_page') }}">批量预测（CSV/Excel）</a>
            <a href="javascript:void(0)" title="供系统对接或移动端调用">
                JSON API：/predict
            </a>
        </div>

        <!-- 警示 -->
        {% if warnings and warnings|length > 0 %}
        <div class="warn-msg">
            <div style="font-weight:700;margin-bottom:4px;">提示：</div>
            <ul style="margin:0;padding-left:18px;">
                {% for w in warnings %}
                <li>{{ w }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- 结果 -->
        {% if score %}
        <div class="result-block">
            <div>
                <strong>体况评分：</strong>
                <span class="score-badge">{{ score }}</span>
            </div>

            <div style="margin-top:6px;">
                评分类型：<span class="result-label">{{ type_label }}</span>
            </div>

            <div style="margin-top:4px;color:#1f6a60;">
                {{ tolerance_hint }}
            </div>

            {% if confidence_text %}
            <div class="confidence">{{ confidence_text }}</div>
            {% endif %}

            <div class="inputs-list">
                <span>体斜长: {{ inputs['体斜长'] }}cm</span>
                <span>胸围: {{ inputs['胸围'] }}cm</span>
                <span>腹围: {{ inputs['腹围'] }}cm</span>
                <span>腰角宽: {{ inputs['腰角宽'] }}cm</span>
                <span>体高: {{ inputs['体高'] }}cm</span>
            </div>
        </div>
        {% endif %}

        <!-- 错误 -->
        {% if error %}
        <div class="error-msg">{{ error }}</div>
        {% endif %}

        <div class="footer">
            国家肉牛改良中心牛体智能测评系统 © 2025
            <small>本系统为科研原型，建议结合现场经验综合判断</small>
        </div>
    </div>
</div>

<script>
    // 示例数据（你可按训练集均值调整）
    const demo = {
        "体斜长": 145.0,
        "胸围": 180.0,
        "腹围": 200.0,
        "腰角宽": 45.0,
        "体高": 125.0
    };

    document.getElementById("fillDemo").addEventListener("click", () => {
        for (const [k, v] of Object.entries(demo)) {
            const el = document.querySelector(`input[name="${k}"]`);
            if (el) el.value = v;
        }
    });

    document.getElementById("clearAll").addEventListener("click", () => {
        document.getElementById("bcsForm").reset();
    });

    // PWA: 注册 Service Worker
    if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
            navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}");
        });
    }
</script>
</body>
</html>
